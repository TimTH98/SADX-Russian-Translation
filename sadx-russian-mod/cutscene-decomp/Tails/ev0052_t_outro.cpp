#include "SADXModLoader.h"
#include "SADXEventFunctions.h"
#include "SADXEventVariables.h"

PVMEntry texTbl_ev0052[] = {
	(char*)("EV_ECCLOUD"), &EV_ECCLOUD_TEXLIST,
	0
};

void ev0052_t_outro(int state)
{
	switch (state) {
	case 1:
		player = EV_GetPlayer(0);
		EV_CameraOn();
		EV_PadOff();
		EV_CanselOn();
		BLACK = COverlayCreate(1.0f, 0.1f, 0.0f, 0.0f, 0.0f);
		BGM_Play(MusicIDs_tails);
		CEcCloud_Start(2.5f, 7);
		EV_SetPos(player, 885.29999f, 126.24f, 1097.55f);
		EV_SetAng(player, 0, 0x152C, 0);
		EV_InitPlayer(0);
		player->twp->timer.b[3] |= 4u; //Change Tails' tails.
		player->twp->timer.b[3] |= 0x20u;
		EV_Wait(1);
		COverlaySetSpeed(BLACK, -0.033333335f);
		EV_SetMotion(player, MILES_OBJECTS[1], motion_m_m9014_miles, &MILES_TEXLIST, 0.89999998f, 1, 0);
		EV_SetMode(player, 0);
		EV_CreatePlayer(2, SonicTheHedgehog, 860.35999f, 126.24f, 1082.87f, 0, 0xCA00, 0);
		EV_SetPath(player, &epathtag_cube0052_t1, 0.5f, 0);
		EV_CameraPos(1, 0, 937.0f, 315.04001f, 1570.069f);
		EV_CameraAng(1, 0, 0xB75, 0x71A6, 0x587);
		EV_CameraTargetObj(0, 1, player, -0.5f, 2.0f, 0.0f, 0);
		EV_Wait(1);
		sonic = EV_GetPlayer(2);
		EV_SetPos(sonic, 860.35999f, 126.24f, 1082.87f);
		EV_SetAng(sonic, 0, 0xCA00, 0);
		EV_CameraChase(player);
		EV_Wait(84);
		EV_CameraChaseFree();
		EV_CameraTargetFree();
		EV_ClrAction(sonic);
		EV_SetAction(sonic, &action_s_s0009_sonic, &SONIC_TEXLIST, 0.5f, 1, 0);
		EV_CameraPos(1, 0, 812.29999f, 278.87701f, 1422.4486f);
		EV_CameraAng(1, 0, 0x10D5, 0xA3F0, 0x100);
		EV_CameraPos(1, 70, 811.02692f, 278.92239f, 1424.0f);
		EV_SetFace(player, "P");
		EV_SetMotion(player, MILES_OBJECTS[1], motion_m_m9015_miles, &MILES_TEXLIST, 1.0f, 0, 0);
		EV_SetMotion(player, MILES_OBJECTS[1], motion_m_m9016_miles, &MILES_TEXLIST, 1.0f, 1, 0);
		EV_Wait(38);
		EV_CameraPos(1, 0, 856.40002f, 249.44f, 1330.626f);
		EV_CameraAng(1, 0, 0xF253, 0xDE82, 0xF600);
		EV_Wait(2);
		EV_CameraChase(player);
		EV_Wait(8);
		EV_CameraTargetObj(1, 60, sonic, 0.0f, 0.0f, 0.0f, 0xF600);
		EV_Wait(50);
		EV_CameraChaseFree();
		EV_CameraTargetFree();
		EV_ClrAction(player);
		EV_SetMotion(player, MILES_OBJECTS[1], motion_m_m9017_miles, &MILES_TEXLIST, 1.0f, 0, 0);
		EV_SetMotion(player, MILES_OBJECTS[1], motion_m_m9018_miles, &MILES_TEXLIST, 1.0f, 1, 0);
		EV_CameraPos(1, 0, 900.659f, 172.0854f, 1156.2f);
		EV_CameraAng(1, 0, 0xE53, 0xA482, 0x200);
		EV_CameraPos(0, 35, 886.96002f, 176.757f, 1170.576f);
		EV_SetFace(player, "G");
		EV_Wait(35);
		CEcCloud_Stop();
		EV_CameraPos(1, 0, 856.41498f, 141.78999f, 1106.537f);
		EV_CameraAng(1, 0, 0xEE25, 0xF6B1, 0xF600);
		EV_CameraPos(0, 25, 858.87701f, 136.7f, 1095.954f);
		EV_Wait(9);
		EV_SetAction(sonic, &action_s_s0068_sonic, &SONIC_TEXLIST, 0.5f, 1, 6);
		EV_LookPoint(sonic, 857.11603f, 138.82401f, 1096.548f);
		EV_Wait(10);
		EV_SetFace(sonic, "P");
		EV_Wait(20);
		EV_ClrPath(player);
		EV_SetPos(player, 882.07001f, 126.6f, 1089.6647f);
		EV_SetAng(player, 0, 0xBEB0, 0);
		EV_ClrAction(player);
		EV_Wait(4);
		EV_SetMotion(player, MILES_OBJECTS[1], motion_m_m0149_miles, &MILES_TEXLIST, 1.0f, 1, 0);
		throughplayer_on(player);
		throughplayer_on(sonic);
		EV_Wait(4);
		EV_SetAng(sonic, 0, 0xBE00, 0);
		EV_SetAction(sonic, &action_s_s0069_sonic, &SONIC_TEXLIST, 0.5f, 1, 6);
		EV_LookFree(player);
		EV_LookFree(sonic);
		EV_CameraPos(1, 0, 860.92999f, 136.94f, 1102.29f);
		EV_CameraAng(1, 0, 0xF400, 0xFFB0, 0);
		EV_CameraPos(0, 30, 860.95001f, 136.07001f, 1099.4f);
		EV_LookObject(sonic, player, 0.0f, 0.0f, 0.0f);
		EV_SetFace(sonic, "P");
		EV_Wait(10);
		EV_SetPath(player, &epathtag_cube0052_t4, 0.69999999f, 0);
		EV_CameraPos(0, 0, 846.65997f, 132.10001f, 1083.423f);
		EV_CameraAng(0, 0, 0, 0xB6B0, 0);
		EV_Wait(10);
		EV_CameraPos(0, 30, 841.20001f, 126.078f, 1089.27f);
		EV_CameraAng(0, 30, 0x1A00, 0xB8B0, 0xFB00);
		EV_Wait(10);
		EV_SetMotion(player, MILES_OBJECTS[1], motion_m_m0150_miles, &MILES_TEXLIST, 1.0f, 1, 8);
		EV_Wait(25);
		EV_SetMode(player, 0);
		EV_Wait(1);
		EV_SetAction(sonic, SONIC_ACTIONS[6], &SONIC_TEXLIST, 2.0f, 1, 0);
		EV_SetPath(player, &epathtag_cube0052_t2, 0.2f, 0);
		EV_SetPath(sonic, &epathtag_cube0052_s1, 0.2f, 0);
		EV_SetFace(player, "bbbbbb");
		EV_CameraPos(1, 0, 982.96002f, 132.13f, 753.12268f);
		EV_CameraAng(1, 0, 0x400, 0x9500, 0);
		EV_CameraPos(0, 86, 943.29999f, 132.17f, 683.28998f);
		EV_CameraAng(0, 86, 0x400, 0x927C, 0);
		EV_Wait(86);
		EV_CameraPos(0, 19, 931.88348f, 131.03999f, 669.2666f);
		EV_CameraAng(0, 19, 0x3E9, 0x90C2, 0xFE00);
		EV_Wait(19);
		EV_LookObject(player, sonic, 0.0f, 0.0f, 0.0f);
		EV_LookObject(sonic, player, 0.0f, 0.0f, 0.0f);
		EV_SetFace(player, "PG");
		EV_SetFace(sonic, "P");
		EV_CameraPos(0, 25, 909.66998f, 123.64f, 661.78802f);
		EV_CameraAng(0, 25, 0xBE5, 0xA485, 0xFE00);
		EV_Wait(25);
		EV_CameraPos(0, 50, 867.54999f, 104.0f, 644.58002f);
		EV_CameraAng(0, 50, 0x104A, 0xA583, 0);
		EV_Wait(25);
		EV_LookFree(player);
		EV_SetFace(player, "bbPbG");
		EV_Wait(25);
		EV_CameraPos(0, 60, 841.28802f, 67.150002f, 608.85498f);
		EV_CameraAng(0, 60, 0xB3B, 0xA125, 0);
		EV_Wait(60);
		EV_CameraPos(0, 34, 829.33002f, 43.787998f, 588.0f);
		EV_CameraAng(0, 34, 0x136A, 0x9B0C, 0);
		EV_Wait(34);
		EV_LookObject(player, sonic, 0.0f, 0.0f, 0.0f);
		EV_SetFace(sonic, "GPGP");
		EV_CameraPos(0, 38, 799.758f, 32.0f, 584.5f);
		EV_CameraAng(0, 38, 0x722, 0x9BF1, 0xFD00);
		EV_Wait(38);
		EV_CameraPos(0, 37, 764.70001f, 10.49f, 600.63202f);
		EV_CameraAng(0, 37, 0x1576, 0xAAD4, 0xA00);
		EV_Wait(37);
		EV_LookFree(sonic);
		EV_CameraPos(0, 60, 717.78998f, 4.0373998f, 622.22998f);
		EV_CameraAng(0, 60, 0x1477, 0xC054, 0x300);
		EV_Wait(60);
		EV_LookFree(player);
		EV_SetFace(player, "bbbbbb");
		EV_CameraPos(0, 50, 666.39001f, -14.026f, 619.77399f);
		EV_CameraAng(0, 50, 0x15EA, 0xBF7C, 0x100);
		EV_Wait(50);
		EV_LookObject(player, sonic, 0.0f, 0.0f, 0.0f);
		EV_SetFace(player, "GPGP");
		EV_CameraPos(0, 22, 647.40002f, -29.136f, 604.40002f);
		EV_CameraAng(0, 22, 0x1A36, 0xB723, 0);
		EV_Wait(22);
		EV_LookFree(player);
		EV_SetFace(player, "bbbbbbbbGbbbbbbPbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb");
		EV_CameraPos(0, 40, 608.59998f, -23.969999f, 601.92999f);
		EV_CameraAng(0, 40, 0x98D, 0xC414, 0);
		EV_Wait(40);
		EV_CameraPos(0, 22, 597.28998f, -16.440001f, 579.76001f);
		EV_CameraAng(0, 22, 0xA6C, 0xBEFD, 0x300);
		EV_Wait(22);
		EV_CameraPos(0, 33, 577.66803f, 6.5250001f, 538.76788f);
		EV_CameraAng(0, 33, 0xFC23, 0xAC25, 0);
		EV_Wait(33);
		EV_CameraPos(0, 27, 540.66669f, 10.324f, 523.78003f);
		EV_CameraAng(0, 27, 0xFD28, 0xAE14, 0xB00);
		EV_Wait(27);
		EV_CameraPos(0, 13, 520.90002f, 12.03f, 520.59998f);
		EV_CameraAng(0, 13, 0x259, 0xC1D5, 0x500);
		EV_Wait(13);
		EV_CameraPos(0, 23, 484.29999f, 10.09f, 521.776f);
		EV_CameraAng(0, 13, 0x259, 0xC1D5, 0x500);
		EV_Wait(23);
		EV_CameraPos(0, 42, 432.47f, 3.0f, 528.68799f);
		EV_CameraAng(0, 42, 0xC84, 0xB7E9, 0xEF00);
		EV_Wait(42);
		EV_CameraPos(0, 26, 399.6665f, 4.2325001f, 543.64001f);
		EV_CameraAng(0, 26, 0xBA7, 0xBD34, 0xF512);
		EV_Wait(26);
		EV_CameraPos(0, 44, 340.431f, 12.147f, 548.90002f);
		EV_CameraAng(0, 44, 0xA17, 0xC6BB, 0);
		EV_Wait(44);
		EV_CameraTargetObj(0, 20, player, 0.0f, 5.0f, 0.0f, 0);
		EV_CameraChase(player);
		EV_Wait(58);
		WHITE = COverlayCreate(0.02f, 0.1f, 1.0f, 1.0f, 1.0f);
		EV_Wait(50);
		player->twp->timer.b[3] &= ~4u; //Reset Tails' tails.
		player->twp->timer.b[3] &= ~0x10u;
		player->twp->timer.b[3] &= ~0x20u;
		EV_ClrFace(player);
		EV_ClrPath(player);
		EV_ClrPath(sonic);
		EV_ClrAction(player);
		EV_ClrAction(sonic);
		EV_SetPos(sonic, 2088.27f, 186.47f, 1560.4f);
		EV_SetAng(sonic, 0xFFBA, 0x30E5, 0x33);
		EV_SetPos(player, 2099.8799f, 186.476f, 1556.354f);
		EV_SetAng(player, 0xFFBA, 0x22CB, 0x33);
		EV_SetAction(player, &action_m_m0001_miles, &MILES_TEXLIST, 1.0f, 1, 0);
		EV_CameraPerspective(0, 1, 0x3111);
		EV_Wait(10);
		EV_SetAng(sonic, 0xFFBA, 0x30E5, 0x33);
		EV_Wait(50);
		EV_CameraPos(0, 0, 2095.6001f, 187.12601f, 1547.13f);
		EV_CameraAng(0, 0, 0xFC1, 0x93BD, 0);
		COverlaySetSpeed(WHITE, -0.016666668f);
		EV_Wait(80);
		EV_CameraPos(0, 80, 2105.7759f, 189.08f, 1551.76f);
		EV_CameraAng(0, 80, 0x10DE, 0x3C69, 0);
		EV_SetFace(player, "PGAPGAPAG");
		EV_Wait(80);
		EV_CameraPos(0, 100, 2105.1421f, 189.08f, 1558.5f);
		EV_CameraAng(0, 100, 0x10DE, 0x3469, 0xFD00);
		EV_Wait(120);
		EV_CameraPos(0, 140, 2163.2756f, 157.33f, 1622.74f);
		EV_CameraAng(0, 140, 0xDDE, 0x1B69, 0xFD00);
		EV_Wait(100);
		EV_ClrAction(player);
		EV_PlayPad(0, &EV0052T);
		EV_Wait(5);
		EV_CameraPos(1, 85, 2171.3999f, 118.0f, 1630.995f);
		EV_CameraAng(1, 85, 0x1B6D, 0x200E, 0xFD00);
		EV_Wait(93);
		EV_CameraAng(0, 15, 0x66D, 0x200E, 0xFD00);
		EV_CameraPos(0, 15, 2171.3f, 124.4f, 1630.665f);
		EV_SetFace(player, "bbbbbbbbbbbbbbbbbbbbbbbbbb");
		EV_SetAction(player, &action_m_m0151_miles, &MILES_TEXLIST, 1.0f, 0, 12);
		EV_SetAction(player, &action_m_m0152_miles, &MILES_TEXLIST, 1.0f, 1, 0);
		EV_SetMode(player, 0);
		EV_SetPath(player, &epathtag_cube0052_t3, 0.0f, 2);
		EV_Wait(50);
		BLACK2 = COverlayCreate(0.033333335f, 0.1f, 0.0f, 0.0f, 0.0f);
		EV_Wait(30);
		break;
	case 2:
		EV_CameraOff();
		stopObjectAll();
		throughplayer_off(player);
		throughplayer_off(sonic);
		EV_ClrPath(player);
		EV_ClrPath(sonic);
		EV_SetPos(player, 1199.0f, 126.0f, 851.0f);
		EV_InitPlayer(0);
		player->twp->timer.b[3] &= ~4u; //Reset Tails' tails.
		player->twp->timer.b[3] &= ~0x10u;
		player->twp->timer.b[3] &= ~0x20u;
		EV_ClrFace(player);
		EV_RemovePlayer(2);
		if(WHITE){
			FreeTask(WHITE);
			WHITE = 0;
		}
		if(BLACK){
			FreeTask(BLACK);
			BLACK = 0;
		}
		if(BLACK2){
			FreeTask(BLACK2);
			BLACK2 = 0;
		}
		CEcCloud_Stop();
		break;
	}
}